{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
	#sim-shell {
		position: relative;
		margin: 0 auto;
		overflow: hidden;
		border-radius: 10px;
		background: #9bd97c;
	}
	#game-container {
		width: 100%;
		height: 100%;
		text-align: center;
	}
	#sim-overlay {
		position: absolute;
		bottom: 10px;
		left: 10px;
		right: 10px;
		z-index: 20;
		padding: 10px 14px;
		background: rgba(255, 255, 255, 0.9);
		border-radius: 8px;
		pointer-events: none;
	}
	#sim-overlay button,
	#sim-overlay input,
	#sim-overlay .row {
		pointer-events: auto;
	}
</style>

<div>
	<div id="sim-shell">
		<div id="game-container"></div>
		<div id="sim-overlay">
			<div class="row">
				<div class="col-md-8" id="game-time">
					<div style="font-size:1.3em; margin-bottom:4px;"><strong>Current Time</strong></div>
					<div style="font-size:2em;"><span id="game-time-content"></span></div>
				</div>
				<div class="col-md-4" style="text-align: right; {% if mode == 'simulate' %} display: none {% endif %}">
					<button id="play_button" type="button" class="btn btn-default">
						<strong style="font-size:1.1em"><i class="glyphicon glyphicon-play"></i> &nbsp;Play</strong>
					</button>
					<button id="pause_button" type="button" class="btn btn-default">
						<strong style="font-size:1.1em"><i class="glyphicon glyphicon-pause"></i> &nbsp;Pause</strong>
					</button>
				</div>
			</div>
			{% if mode == 'replay' %}
			<div class="row" style="margin-top:8px">
				<div class="col-md-12">
					<input id="step-slider" type="range" min="0" max="{{max_step}}" value="{{step}}" style="width:100%">
					<div style="text-align:right; color:#555;">Step: <span id="step-indicator">{{step}}</span> / {{max_step}}</div>
				</div>
			</div>
			{% endif %}
		</div>
	</div>

	<div style="width:85%; margin: 0 auto; margin-top:2em">
		<hr style="border-color:#999999">
		<br>

		{% for p_name, p_name_os in persona_names %}
			<div class="media" style="background-color:#EEEEEE; padding:1em; padding-left:3.5em; padding-right:2em; border-radius:10px">
			  <div class="media-left media-middle">
			    <a href="#" class="focus-trigger" data-persona="{{ p_name }}">
			      <img class="media-object" src="{% static 'assets/characters/profile/' %}{{ p_name_os }}.png" style="width:5em" alt="{{ p_name }}">
			    </a>
			  </div>
			  <div class="media-body" style='padding-left:3em; padding-top:0.5em; padding-bottom:1em'>
			  	<div class="row">
			    	<h2 class="col-md-8 focus-trigger" id="name__{{ p_name_os }}" data-persona="{{ p_name }}" style="margin-bottom:0.8em; font-size:1.85em; cursor: pointer;">
			    		{{p_name}} &nbsp;&nbsp;
			    		<a href="{% url 'replay_persona_state' sim_code step p_name_os %}" style="font-size:0.6em">State Details</a>
			    	</h2>
			    </div>
			    <div style="">
					  <p style="font-size:1.2em"><strong>Current Action:</strong> <br><span id="current_action__{{ p_name_os }}"></span></p>
					  <p style="font-size:1.2em"><strong>Location:</strong> <br><span id="target_address__{{ p_name_os }}"></span></p>
					  <p style="font-size:1.2em"><strong>Current Conversation:</strong> <br><span id="chat__{{ p_name_os }}"></span></p>
					</div>
			  </div>
			</div>	
			<br>
		{% endfor %}




		

	</div>
</div>

  



<div style="padding-bottom:6em"> </div>

<div id="temp_focus" style="display:none"></div>

<!-- partial -->
<script src='https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js'></script>
{% include 'home/main_script.html' %}
<script>
	document.querySelectorAll('.focus-trigger').forEach(function(el) {
		el.addEventListener('click', function(evt) {
			evt.preventDefault();
			const persona = el.getAttribute('data-persona');
			if (!persona) return;
			console.log('Focusing on persona:', persona);
			document.getElementById('temp_focus').innerHTML = persona;
		});
	});
</script>
{% endblock content %}

